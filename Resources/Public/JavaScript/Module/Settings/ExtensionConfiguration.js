/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}();define(["require","exports","../AbstractInteractableModule","jquery","../../Router","TYPO3/CMS/Backend/Notification","bootstrap"],function(t,e,a,n,r,i){"use strict";return new(function(e){function a(){var t=null!==e&&e.apply(this,arguments)||this;return t.selectorFormListener=".t3js-extensionConfiguration-form",t.selectorSearchInput=".t3js-extensionConfiguration-search",t}return __extends(a,e),a.prototype.initialize=function(e){var a=this;this.currentModal=e,this.getContent(),e.on("keydown",function(t){var n=e.find(a.selectorSearchInput);t.ctrlKey||t.metaKey?"f"===String.fromCharCode(t.which).toLowerCase()&&(t.preventDefault(),n.focus()):27===t.keyCode&&(t.preventDefault(),n.val("").focus())}),e.on("keyup",this.selectorSearchInput,function(r){var i=n(r.target).val(),o=e.find(a.selectorSearchInput);e.find(".search-item").each(function(t,e){var a=n(e);n(":contains("+i+")",a).length>0||n('input[value*="'+i+'"]',a).length>0?a.removeClass("hidden").addClass("searchhit"):a.removeClass("searchhit").addClass("hidden")}),e.find(".searchhit").collapse("show"),t(["jquery.clearable"],function(){o.clearable().focus()})}),e.on("submit",this.selectorFormListener,function(t){t.preventDefault(),a.write(n(t.currentTarget))})},a.prototype.getContent=function(){var t=this,e=this.getModalBody();n.ajax({url:r.getUrl("extensionConfigurationGetContent"),cache:!1,success:function(a){!0===a.success&&(Array.isArray(a.status)&&a.status.forEach(function(t){i.success(t.title,t.message)}),e.html(a.html),t.initializeWrap())},error:function(t){r.handleAjaxError(t,e)}})},a.prototype.write=function(t){var e=this.getModalBody(),a=this.getModuleContent().data("extension-configuration-write-token"),o={};n.each(t.serializeArray(),function(t,e){o[e.name]=e.value}),n.ajax({url:r.getUrl(),method:"POST",data:{install:{token:a,action:"extensionConfigurationWrite",extensionKey:t.attr("data-extensionKey"),extensionConfiguration:o}},success:function(t){!0===t.success&&Array.isArray(t.status)?t.status.forEach(function(t){i.showMessage(t.title,t.message,t.severity)}):i.error("Something went wrong")},error:function(t){r.handleAjaxError(t,e)}}).always(function(){})},a.prototype.initializeWrap=function(){this.findInModal(".t3js-emconf-offset").each(function(t,e){var a=n(e),r=a.parent(),i=a.attr("id"),o=a.attr("value").split(",");a.attr("data-offsetfield-x","#"+i+"_offset_x").attr("data-offsetfield-y","#"+i+"_offset_y").wrap('<div class="hidden"></div>');var s=n("<div>",{class:"form-multigroup-item"}).append(n("<div>",{class:"input-group"}).append(n("<div>",{class:"input-group-addon"}).text("x"),n("<input>",{id:i+"_offset_x",class:"form-control t3js-emconf-offsetfield","data-target":"#"+i,value:n.trim(o[0])}))),f=n("<div>",{class:"form-multigroup-item"}).append(n("<div>",{class:"input-group"}).append(n("<div>",{class:"input-group-addon"}).text("y"),n("<input>",{id:i+"_offset_y",class:"form-control t3js-emconf-offsetfield","data-target":"#"+i,value:n.trim(o[1])}))),c=n("<div>",{class:"form-multigroup-wrap"}).append(s,f);r.append(c),r.find(".t3js-emconf-offsetfield").keyup(function(t){var e=r.find(n(t.currentTarget).data("target"));e.val(r.find(e.data("offsetfield-x")).val()+","+r.find(e.data("offsetfield-y")).val())})}),this.findInModal(".t3js-emconf-wrap").each(function(t,e){var a=n(e),r=a.parent(),i=a.attr("id"),o=a.attr("value").split("|");a.attr("data-wrapfield-start","#"+i+"_wrap_start").attr("data-wrapfield-end","#"+i+"_wrap_end").wrap('<div class="hidden"></div>');var s=n("<div>",{class:"form-multigroup-wrap"}).append(n("<div>",{class:"form-multigroup-item"}).append(n("<input>",{id:i+"_wrap_start",class:"form-control t3js-emconf-wrapfield","data-target":"#"+i,value:n.trim(o[0])})),n("<div>",{class:"form-multigroup-item"}).append(n("<input>",{id:i+"_wrap_end",class:"form-control t3js-emconf-wrapfield","data-target":"#"+i,value:n.trim(o[1])})));r.append(s),r.find(".t3js-emconf-wrapfield").keyup(function(t){var e=r.find(n(t.currentTarget).data("target"));e.val(r.find(e.data("wrapfield-start")).val()+"|"+r.find(e.data("wrapfield-end")).val())})})},a}(a.AbstractInteractableModule))});