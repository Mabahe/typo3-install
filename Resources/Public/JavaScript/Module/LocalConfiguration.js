/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();define(["require","exports","./AbstractInteractableModule","jquery","../Router","TYPO3/CMS/Backend/Notification","bootstrap"],function(t,e,r,o,n,a){"use strict";return new(function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.selectorToggleAllTrigger=".t3js-localConfiguration-toggleAll",t.selectorWriteTrigger=".t3js-localConfiguration-write",t.selectorSearchTrigger=".t3js-localConfiguration-search",t}return __extends(r,e),r.prototype.initialize=function(e){var r=this;this.currentModal=e,this.getContent(),e.on("click",this.selectorWriteTrigger,function(){r.write()}),e.on("click",this.selectorToggleAllTrigger,function(){var t=r.getModalBody().find(".panel-collapse"),e=t.eq(0).hasClass("in")?"hide":"show";t.collapse(e)}),jQuery.expr[":"].contains=jQuery.expr.createPseudo(function(t){return function(e){return jQuery(e).text().toUpperCase().indexOf(t.toUpperCase())>=0}}),e.on("keydown",function(t){var o=e.find(r.selectorSearchTrigger);t.ctrlKey||t.metaKey?"f"===String.fromCharCode(t.which).toLowerCase()&&(t.preventDefault(),o.focus()):27===t.keyCode&&(t.preventDefault(),o.val("").focus())}),e.on("keyup",this.selectorSearchTrigger,function(n){var a=o(n.target).val(),i=e.find(r.selectorSearchTrigger);e.find("div.item").each(function(t,e){var r=o(e);o(":contains("+a+")",r).length>0||o('input[value*="'+a+'"]',r).length>0?r.removeClass("hidden").addClass("searchhit"):r.removeClass("searchhit").addClass("hidden")}),e.find(".searchhit").parent().collapse("show"),t(["jquery.clearable"],function(){i.clearable().focus()})})},r.prototype.getContent=function(){var t=this.getModalBody();o.ajax({url:n.getUrl("localConfigurationGetContent"),cache:!1,success:function(e){!0===e.success&&(Array.isArray(e.status)&&e.status.forEach(function(t){a.success(t.title,t.message)}),t.html(e.html))},error:function(e){n.handleAjaxError(e,t)}})},r.prototype.write=function(){var t=this.getModalBody(),e=this.getModuleContent().data("local-configuration-write-token"),r={};this.findInModal(".t3js-localConfiguration-pathValue").each(function(t,e){var n=o(e);"checkbox"===n.attr("type")?e.checked?r[n.data("path")]="1":r[n.data("path")]="0":r[n.data("path")]=n.val()}),o.ajax({url:n.getUrl(),method:"POST",data:{install:{action:"localConfigurationWrite",token:e,configurationValues:r}},cache:!1,success:function(t){!0===t.success&&Array.isArray(t.status)?t.status.forEach(function(t){a.showMessage(t.title,t.message,t.severity)}):a.error("Something went wrong")},error:function(e){n.handleAjaxError(e,t)}})},r}(r.AbstractInteractableModule))});