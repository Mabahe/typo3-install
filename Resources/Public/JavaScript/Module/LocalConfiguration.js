/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
define(["require","exports","jquery","../Router","TYPO3/CMS/Backend/Notification","bootstrap"],function(e,t,r,o,n){"use strict";return new(function(){function t(){this.selectorModalBody=".t3js-modal-body",this.selectorModuleContent=".t3js-module-content",this.selectorToggleAllTrigger=".t3js-localConfiguration-toggleAll",this.selectorWriteTrigger=".t3js-localConfiguration-write",this.selectorSearchTrigger=".t3js-localConfiguration-search"}return t.prototype.initialize=function(t){var o=this;this.currentModal=t,this.getContent(),t.on("click",this.selectorWriteTrigger,function(){o.write()}),t.on("click",this.selectorToggleAllTrigger,function(){var e=o.currentModal.find(o.selectorModalBody).find(".panel-collapse"),t=e.eq(0).hasClass("in")?"hide":"show";e.collapse(t)}),jQuery.expr[":"].contains=jQuery.expr.createPseudo(function(e){return function(t){return jQuery(t).text().toUpperCase().indexOf(e.toUpperCase())>=0}}),t.on("keydown",function(e){var r=t.find(o.selectorSearchTrigger);e.ctrlKey||e.metaKey?"f"===String.fromCharCode(e.which).toLowerCase()&&(e.preventDefault(),r.focus()):27===e.keyCode&&(e.preventDefault(),r.val("").focus())}),t.on("keyup",this.selectorSearchTrigger,function(n){var a=r(n.target).val(),i=t.find(o.selectorSearchTrigger);t.find("div.item").each(function(e,t){var o=r(t);r(":contains("+a+")",o).length>0||r('input[value*="'+a+'"]',o).length>0?o.removeClass("hidden").addClass("searchhit"):o.removeClass("searchhit").addClass("hidden")}),t.find(".searchhit").parent().collapse("show"),e(["jquery.clearable"],function(){i.clearable().focus()})})},t.prototype.getContent=function(){var e=this.currentModal.find(this.selectorModalBody);r.ajax({url:o.getUrl("localConfigurationGetContent"),cache:!1,success:function(t){!0===t.success&&(Array.isArray(t.status)&&t.status.forEach(function(e){n.success(e.title,e.message)}),e.html(t.html))},error:function(t){o.handleAjaxError(t,e)}})},t.prototype.write=function(){var e=this.currentModal.find(this.selectorModalBody),t=this.currentModal.find(this.selectorModuleContent).data("local-configuration-write-token"),a={};this.currentModal.find(".t3js-localConfiguration-pathValue").each(function(e,t){var o=r(t);"checkbox"===o.attr("type")?t.checked?a[o.data("path")]="1":a[o.data("path")]="0":a[o.data("path")]=o.val()}),r.ajax({url:o.getUrl(),method:"POST",data:{install:{action:"localConfigurationWrite",token:t,configurationValues:a}},cache:!1,success:function(e){!0===e.success&&Array.isArray(e.status)?e.status.forEach(function(e){n.showMessage(e.title,e.message,e.severity)}):n.error("Something went wrong")},error:function(t){o.handleAjaxError(t,e)}})},t}())});